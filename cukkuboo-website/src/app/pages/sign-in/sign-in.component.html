<section class="position-relative pb-0 sign_wrpr" [class.popup]="modalData">
  <div class="gen-login-page-background" style="background-image: url('assets/images/background/movie_banner.jpg')"></div>

  <div [ngClass]="modalData ? 'container-fluid m-0 p-0' : 'container'">
    <div class="row">
      <div class="col-lg-12">
        <div class="text-center">
          <form
            [formGroup]="step === 0 ? loginForm : forgotForm"
            (ngSubmit)="step === 0 ? onSubmit() : null"
            id="pms_login"
          >
            <!-- Logo -->
            <div class="text-center mb-3 clickable-logo" routerLink="/">
              <img src="assets/images/logo-collapsed.png" alt="Logo" style="max-width: 60px;" />
            </div>

            <!-- Headings -->
            <h4 class="text-start">
              {{
                step === 0
                  ? 'Sign In' + (modalData ? ' To Continue' : '')
                  : step === 1
                  ? 'Forgot Password'
                  : step === 2
                  ? 'Enter OTP'
                  : 'Reset Password'
              }}
            </h4>

            <!-- Step 0: Login -->
            <ng-container *ngIf="step === 0">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Email Address</mat-label>
                <input matInput formControlName="email" placeholder="Enter your email" />
                <mat-error>
                  <Validation-Messages [control]="loginForm.controls['email']"></Validation-Messages>
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Password</mat-label>
                <input matInput [type]="hide ? 'password' : 'text'" formControlName="password" placeholder="Enter your password" />
                <button mat-icon-button matSuffix (click)="hide = !hide" type="button">
                  <mat-icon class="small-eye-icon">{{ hide ? 'visibility_off' : 'visibility' }}</mat-icon>
                </button>
                <mat-error>
                  <Validation-Messages [control]="loginForm.controls['password']"></Validation-Messages>
                </mat-error>
              </mat-form-field>

              <div class="text-start mt-3">
                <button type="submit" class="red-button">Sign-In</button>
              </div>

              <div class="text-start mt-2">
                <a (click)="startForgotFlow()" class="red-link">Forgot Password?</a>
              </div>

              <div class="text-start mt-2">
                <span class="me-2">Don't have an account?</span>
                <a (click)="navigateToSignUp()" class="signup-link red-link">Sign Up</a>
              </div>
            </ng-container>

            <!-- Step 1: Enter Email -->
            <ng-container *ngIf="step === 1">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Email Address</mat-label>
                <input matInput formControlName="email" />
              </mat-form-field>

              <button type="button" class="red-button w-100 mt-2" (click)="sendEmail()">Send OTP</button>
              <div class="text-start mt-2">
                <a (click)="goBackToLogin()" class="red-link">Back to Login</a>
              </div>
            </ng-container>

            <!-- Step 2: Enter OTP -->
            <ng-container *ngIf="step === 2">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>OTP</mat-label>
                <input matInput formControlName="otp" />
              </mat-form-field>

              <button type="button" class="red-button w-100 mt-2" (click)="submitOtp()">Verify OTP</button>
              <div class="text-start mt-2">
                <a (click)="goBackToLogin()" class="red-link">Back to Login</a>
              </div>
            </ng-container>

            <!-- Step 3: Reset Password -->
            <ng-container *ngIf="step === 3">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>New Password</mat-label>
                <input matInput type="password" formControlName="new_password" />
                <mat-error *ngIf="forgotForm.controls['new_password'].hasError('required')">
                  Password is required
                </mat-error>
                <mat-error *ngIf="forgotForm.controls['new_password'].hasError('minlength')">
                  Password must be at least 8 characters
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Confirm Password</mat-label>
                <input matInput type="password" formControlName="confirm_password" />
                <mat-error *ngIf="forgotForm.controls['confirm_password'].hasError('required')">
                  Confirm password is required
                </mat-error>
                <mat-error *ngIf="forgotForm.controls['confirm_password'].hasError('minlength')">
                  Password must be at least 8 characters
                </mat-error>
              </mat-form-field>

              <button type="button" class="red-button w-100 mt-2" (click)="resetPassword()">Reset Password</button>
              <div class="text-start mt-2">
                <a (click)="goBackToLogin()" class="red-link">Back to Login</a>
              </div>
            </ng-container>

          </form>
        </div>
      </div>
    </div>
  </div>
</section>
